<div class="container mt-5">
	<button (click)="goBack()" class="btn btn-primary position-fixed top-0 end-0 m-3 shadow">
		<i class="bi bi-arrow-left me-1"></i> Regresar
	</button>

	<h2 class="text-center mb-3">Listado de Accesos</h2>

	<p class="text-center fw-bold"
		 [ngClass]="{
			 'text-success': mensaje.startsWith('✅'),
			 'text-danger': mensaje.startsWith('❌'),
			 'text-warning': mensaje.startsWith('⚠️')
		 }">
		{{ mensaje }}
	</p>

	<div *ngIf="loading" class="text-center my-4">
		<div class="spinner-border text-primary" role="status"><span class="visually-hidden">Loading...</span></div>
	</div>

	<div *ngIf="!loading && accesos.length === 0" class="text-center text-muted">No hay accesos registrados.</div>

	<!-- Mostrar respuesta cruda en caso de error para depuración -->
	<div *ngIf="rawError" class="mt-3 card p-3 shadow-sm">
		<h6 class="mb-2">Error (respuesta cruda)</h6>
		<pre class="small" style="white-space:pre-wrap;">{{ rawError | json }}</pre>
	</div>

	<!-- Formulario para buscar por ID -->
	<div class="row mb-3">
		<div class="col-md-8">
			<form [formGroup]="searchForm" (ngSubmit)="buscarPorId()" class="d-flex gap-2">
				<input formControlName="id" class="form-control" placeholder="Buscar por ID de usuario" />
				<button class="btn btn-outline-primary" [disabled]="searchForm.invalid">Buscar</button>
				<button type="button" class="btn btn-secondary" (click)="limpiarBusqueda()">Limpiar</button>
			</form>
		</div>
	</div>

	<!-- Mostrar resultado individual si existe -->
	<div *ngIf="foundUser" class="card p-3 mb-3 shadow-sm">
		<h5 class="mb-2">Usuario encontrado</h5>

		<!-- Modo visualización -->
		<div *ngIf="!editMode">
			<ul class="list-unstyled small mb-0">
				<li *ngIf="foundUser['nombre']"><strong>Nombre:</strong> {{ foundUser['nombre'] }}</li>
				<li *ngIf="foundUser['apellido']"><strong>Apellido:</strong> {{ foundUser['apellido'] }}</li>
				<li *ngIf="foundUser['correo']"><strong>Correo:</strong> {{ foundUser['correo'] }}</li>
				<li *ngIf="foundUser['rut']"><strong>RUT:</strong> {{ foundUser['rut'] }}</li>
				<li *ngIf="foundUser['_id']"><strong>ID:</strong> {{ foundUser['_id'] }}</li>
			</ul>
			<div class="mt-3">
				<button class="btn btn-outline-primary me-2" (click)="startEdit()">Editar</button>
				<button class="btn btn-danger me-2" (click)="eliminarUsuarioEncontrado()">Eliminar</button>
				<button class="btn btn-secondary" (click)="limpiarBusqueda()">Cerrar</button>
			</div>
		</div>

		<!-- Modo edición -->
		<div *ngIf="editMode">
			<form [formGroup]="editForm" (ngSubmit)="guardarEdicion()">
				<div class="mb-2">
					<label class="form-label">Nombre</label>
					<input class="form-control" formControlName="nombre" />
				</div>
				<div class="mb-2">
					<label class="form-label">Apellido</label>
					<input class="form-control" formControlName="apellido" />
				</div>
				<div class="mb-2">
					<label class="form-label">Correo</label>
					<input class="form-control" formControlName="correo" />
				</div>
				<div class="d-flex gap-2">
					<button type="submit" class="btn btn-success" [disabled]="editForm.invalid">Guardar</button>
					<button type="button" class="btn btn-secondary" (click)="cancelarEdicion()">Cancelar</button>
				</div>
			</form>
		</div>
	</div>

	<div *ngIf="!loading && accesos.length > 0" class="table-responsive mt-3">
		<table class="table table-hover align-middle">
			<thead class="table-light">
				<tr>
					<th>Nombre</th>
					<th>Apellido</th>
					<th>Correo</th>
					<th>RUT</th>
					<th>ID</th>
				</tr>
			</thead>
			<tbody>
						<tr *ngFor="let a of accesos">
							<td>{{ a['nombre'] ?? '-' }}</td>
							<td>{{ a['apellido'] ?? '-' }}</td>
							<td>{{ a['correo'] ?? '-' }}</td>
							<td>{{ a['rut'] ?? '-' }}</td>
							<td>{{ a['_id'] ?? '-' }}</td>
						</tr>
			</tbody>
		</table>
	</div>
</div>
